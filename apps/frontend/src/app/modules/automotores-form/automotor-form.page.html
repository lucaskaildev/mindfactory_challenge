<h2 class="text-2xl font-semibold">{{ isEdit ? 'Editar automotor' : 'Crear automotor' }}</h2>

<ng-container *ngIf="loading">
  <div class="mt-4 text-gray-600">Cargando...</div>
</ng-container>

<ng-container *ngIf="!loading">
  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="mt-4 grid grid-cols-1 gap-4 max-w-xl">
    <div>
      <label class="block text-sm text-gray-700 mb-1">Dominio</label>
      <input
        type="text"
        formControlName="dominio"
        class="w-full border rounded px-3 py-2"
        [class.border-red-500]="form.get('dominio')?.invalid && form.get('dominio')?.touched"
        placeholder="AAA999 o AA999AA"
        maxlength="8"
        (input)="onDominioInput($event)"
      />
      <div class="text-xs text-red-600 mt-1" *ngIf="form.get('dominio')?.invalid && form.get('dominio')?.touched">
        Ingrese un dominio válido (AAA999 o AA999AA)
      </div>
    </div>

    <div>
      <label class="block text-sm text-gray-700 mb-1">N° Chasis</label>
      <input type="text" formControlName="numeroChasis" class="w-full border rounded px-3 py-2" />
    </div>

    <div>
      <label class="block text-sm text-gray-700 mb-1">N° Motor</label>
      <input type="text" formControlName="numeroMotor" class="w-full border rounded px-3 py-2" />
    </div>

    <div>
      <label class="block text-sm text-gray-700 mb-1">Color</label>
      <input type="text" formControlName="color" class="w-full border rounded px-3 py-2" />
    </div>

    <div>
      <label class="block text-sm text-gray-700 mb-1">Fecha fabricación (YYYYMM)</label>
      <input
        type="text"
        formControlName="fechaFabricacion"
        class="w-full border rounded px-3 py-2"
        [class.border-red-500]="form.get('fechaFabricacion')?.invalid && form.get('fechaFabricacion')?.touched"
        placeholder="YYYYMM"
        maxlength="6"
      />
      <div class="text-xs text-red-600 mt-1" *ngIf="form.get('fechaFabricacion')?.invalid && form.get('fechaFabricacion')?.touched">
        Ingrese una fecha válida (YYYYMM no futura)
      </div>
    </div>

    <div>
      <label class="block text-sm text-gray-700 mb-1">CUIT Dueño</label>
      <input
        type="text"
        formControlName="cuitDuenio"
        class="w-full border rounded px-3 py-2"
        [class.border-red-500]="form.get('cuitDuenio')?.invalid && form.get('cuitDuenio')?.touched"
        placeholder="Sólo números (11)"
        maxlength="11"
      />
      <div class="text-xs text-red-600 mt-1" *ngIf="form.get('cuitDuenio')?.invalid && form.get('cuitDuenio')?.touched">
        Ingrese un CUIT válido (11 dígitos)
      </div>
    </div>

    <div *ngIf="error" class="text-red-700 bg-red-50 border border-red-200 p-3 rounded">
      <div>{{ error }}</div>
      <ul class="list-disc ml-5 mt-1" *ngIf="errors.length">
        <li *ngFor="let e of errors">{{ e }}</li>
      </ul>
    </div>

    <div class="flex gap-2 items-center">
      <button
        type="submit"
        class="px-4 py-2 bg-green-600 text-white rounded disabled:opacity-50 disabled:cursor-not-allowed"
        [disabled]="form.invalid || saving"
      >
        {{ saving ? 'Guardando...' : 'Guardar' }}
      </button>
      <a routerLink="/automotores" class="text-blue-600 underline">Volver al listado</a>
    </div>
  </form>
</ng-container>
